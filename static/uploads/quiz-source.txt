TUES11SW-VMKS-2 semester Lecture 1Аналогов вход и АЦПВМКС II срок лекция 1Аналогови сигнали2- Всички сигнали в природата са аналогови по своята същност.- Те са непрекъснати във времето (във всеки момент от времето те имат някаква стойност).- Звук, светлина, дим, цветоусещане, топлоусещане, аромат…. - Радиовълните в ефира също са аналогови ! - В сравнение с цифровите сигнали, които представят информацията като дискретни стойности (нули и единици), аналоговите сигнали предават по-голям обем информация, но са по-податливи на шум и загуба на качество при предаване.Аналогово цифрово преобразуване3- Всички устройства, които съхраняват и обработватинформация работят с цифрови сигнали.- Това налага необходимостта от аналогово - цифрово преобразуване и устройствата, които го осъществяват се наричат аналогово - цифрови преобразуватели. Съкратено: АЦП (ADC на английски)- ADC ни позволява да конвертираме аналогови данни от реалния свят, като аудио, видео, температура или показания на сензори, в цифров формат, който може да бъде манипулиран от компютри и цифрови системи.Аналогов вход и АЦП4- В почти всеки микроконтролер днес има по няколко аналогови входа.- Това на практика представляват АЦП-та вградени като част от микроконтролерна архитектура.- АЦП могат да се намерят и като дискретни (самостоятелни) компоненти, които да се интегрират в различни приложения.- Звукова карта- CCD матрица- Микрофон- Примери за ADC, като самостоятелни компоненти: https://www.ti.com/data-converters/adc-circuit/products.html#84=20%3B32&sort=84;desc& https://www.ti.com/data-converters/adc-circuit/products.html#84=20%3B32&sort=84;desc&https://www.ti.com/data-converters/adc-circuit/products.html#84=20%3B32&sort=84;desc&Аналогов интерфейс в Ардуино (ATmega328P)5- От спецификацията на ATmega328P: Източник , раздел 23, страница 205 https://ww1.microchip.com/downloads/en/DeviceDoc/Atmel-7810-Automotive-Microcontrollers-ATmega328P_Datasheet.pdfАналогов интерфейс в Ардуино (ATmega328P)6- От спецификацията на ATmega328P: Източник , раздел 23, страница 206 Още по-oпростена блокова диаграмаhttps://ww1.microchip.com/downloads/en/DeviceDoc/Atmel-7810-Automotive-Microcontrollers-ATmega328P_Datasheet.pdfКак работи АЦП ?7- 3 основни етапа на аналогово - цифровото преобразуване- 1. Дискретизация по време- 2. Квантуване по ниво- 3. Кодиране в двоичен код31 2Основни параметри на АЦП8- Опорно напрежение VREF, [V]. Това е напрежението спрямо, което се сравнява аналоговият сигнал в процесa на преобразуване. Аналоговите сигнали, които АЦП ще обработва могат да са с амплитуда ≦ VREF. Това напрежение трябва да бъде с много висока точност.- Разрядност(разделителна способност) n, [bits]. Целият обхват на входното напрежение 0V(илиVagnd)  до VREF е разделен на няколко поддиапазона, които може да наречем стъпки. За всяка стъпка се присвоява единичен изходен цифров код. Една стъпка се нарича още LSB (най-малко значим бит) и броят на тези стъпки обикновено са в степени на две (2n). Тук n се нарича разделителна способност на ADC, а 2n осигурява броя на стъпките. *Vagnd - аналогово референсно “нулево” напрежение на АЦП. То определя минималното напрежение, което може да се измери. В някои приложения може да е различно от 0V !Основни параметри на АЦП зависещи от разредността и VREF9- Грешка от квантуване: Несъответствието между истинската аналогова стойност и нейното цифрово представяне е известно като грешка от  квантуване. Възможно е по-прецизно квантуване при по-високи разделителни способности, което намалява тази грешка.- Динамичен диапазон, [dB]: това е съотношението на най-големите към най-малките сигнали, които могат да бъдат прецизно измерени и е тясно свързан с разделителната способност. ADC може да открие малки промени, когато има силни сигнали, благодарение на по-голяма разрядност, която води до по-голям динамичен диапазон.- Отношение сигнал/шум SNR, [dB]: По-високата разделителна способност повишава SNR, тъй като нивото на шума, предизвикано от грешката от квантуване, се намалява. Но има и други фактори, които влияят на това отношение (като например собствения шум на АЦП).Основни параметри на АЦП10- Честота на дискретизация (sampling rate/ sampling frequency), [SPS или Hz]: Този параметър показва скоростта на преобразуване на аналоговите данни от аналогов в цифров формат. Измерва се в samples per second или в Hz. Честотата на дискретизация определя честотната лента, в която може да бъде точно преобразуван  аналоговият сигнал. Колкото по-голяма е честотата на дискретизация, толкова по-точно можем да преобразуваме даден сигнал. Важно е да се знае, че честотата на дискретизация е ограничаващ фактор за сигналите които можем да обработваме.За коректно преобразуване на аналогов сигнал трябва да е изпълнено условието на Найкуист:Fs ≧ 2 x B Където Fs  e честотата на дискретизация а B е честотната лента на сигнала.- Коефициент на нелинейни изкривявания (THD): измерва нелинейните изкривявания при преобразуване на аналогови сигнали. По-ниските стойности на THD водят до по-добра точност.Основни параметри на АЦП11- Ефективен брой битове (ENOB), [n] : Броят на битовете в идеален ADC със същата разделителна способност като тествания ADC се обозначава с ENOB. Той измерва реалната разделителна способност на ADC, когато се вземат предвид нивата на шум и нелинейни изкривявания.- Интегрална нелинейност (INL):INL измерва отклонението от идеалния линеен отклик на ADC в процеса на квантуване.- Диференциална нелинейност(DNL): DNL измерва разликата между идеалния размер на стъпката и действителния размер на стъпката на ADC.- Грешка от отместване на нулата(offset error): дефинира се като отклонение на действителната трансферна функция на ADC от перфектната ADC трансферна функция в точката на нула към прехода, измерен в LSB бита.- За повече информация и още параметри: https://ww1.microchip.com/downloads/en/Appnotes/atmel-8456-8-and-32-bit-avr-microcontrollers-avr127-understanding-adc-parameters_application-note.pdf https://ww1.microchip.com/downloads/en/Appnotes/atmel-8456-8-and-32-bit-avr-microcontrollers-avr127-understanding-adc-parameters_application-note.pdfhttps://ww1.microchip.com/downloads/en/Appnotes/atmel-8456-8-and-32-bit-avr-microcontrollers-avr127-understanding-adc-parameters_application-note.pdfГрешка от отместване на нулата (offset error)12✭Грешката от отместване ограничава наличният диапазон на АЦП. Голяма грешка при положително отместване води до насищане на изхода, преди входното напрежение да достигне максимум на диапазона. Голяма грешка при отрицателно отместване дава изходна стойност 000 за най-ниските входни напрежения.Диференциална нелинейност(DNL)13✭Диференциалната нелинейност (DNL) се определя като максималната и минималната разлика в ширината на стъпката между действителната трансферна функция и идеалната трансферна функция. Нелинейността води до квантуване със стъпка, която има променлив размер.Интегрална нелинейност (INL)14✭Интегралната нелинейност (INL) се определя като максималната вертикална разлика между действителната и идеалната крива. Той показва степента на отклонение на действителната крива от идеалната крива на трансфер. INL може да бъде интерпретиран като сбор от DNL.Типове АЦП15- Flash ADCs- SAR ADCs- Pipeline ADCs- Delta-Sigma ADCs- Integrating ADCsSample and hold circuit16Flash ADC17- Най-бързите АЦП- Най-сложните- Трудно се постига голяма резолюция- Висока консумация на енергия- Прости като архитектура, но сложни за реализация на голяма разрядност- Консумират много енергия- Изградени са от 2n - 1 компаратори, резисторна стълба, XOR елементи и енкодер към двоичен код- Намират приложение при обработка на високоскоростни данни и видеоMore info: Flash ADChttps://www.monolithicpower.com/en/analog-to-digital-converters/detailed-analysis-of-adc-architectures/flash-adcsSAR ADC (Successive Approximation Register)18- Изградени са от Sample/Hold верига, компаратор, ЦАП, SAR с обратна връзка- С тях лесно се постига средна до висока резолюция- Лесни са за реализация- Поддържат средни скорости на обработка- Ниска до средна консумация на енергия- Използват се масово в микроконтролери и приложения свързани със сензориMore info: SAR ADC✭Терминът "последователно приближение" се отнася до итеративния метод, използван от ADC за оценка на аналоговото входно напрежение. Той работи, като постепенно усъвършенства своята апроксимация на стъпки, като всеки път се доближава до действителното входно напрежение.https://www.monolithicpower.com/en/analog-to-digital-converters/detailed-analysis-of-adc-architectures/sar-adcsPipeline ADC19More info: Pipeline ADC 1   Pipeline ADC 2- Изградени са от няколко каскадно свързани АЦП блока- Съдържат много Flash ADC блокове и ЦАП- Имат и логически блок за корекция на грешката от преобразуване (блок за калибрация)- Много бързи, но не колкото Flash- Много сложни- Много точни- Много скъпи- С голяма консумация на енергия- С голяма разрядностhttps://people.ece.umn.edu/~harjani/courses/8331/ADC-pipeline_lecture.PDFhttps://www.analog.com/en/resources/technical-articles/understanding-pipelined-adcs.htmlDelta-Sigma ADC20More info:Delta -Sigma ADC 1  Delta -Sigma ADC 2- Използват техники за цифрова обработка на сигнала(DSP), за да намаляват нивото на шума- Поради структурата си постигат изключително висока резолюция- Не са особено бързи- Най-сложна архитектура- Средна консумация на мощност✭Този модулатор е съставен от отрицателна обратна връзка, включваща интегратор, компаратор и 1-битов ЦАП(DAC). Интеграторът акумулира несъответствията между входния сигнал и изхода на 1-битовия DAC. После компараторът проверява този интегриран изход спрямо референтно напрежение. Резултатът се преобразува в 1-битов поток от данни, който след това се връща обратно чрез 1-битов DAC, затварящ итеративната верига за обратна връзка.https://www.monolithicpower.com/en/analog-to-digital-converters/detailed-analysis-of-adc-architectures/delta-sigma-adcshttps://www.ti.com/lit/an/slyt423a/slyt423a.pdf?ts=1707116308868&ref_url=https%253A%252F%252Fwww.ti.com%252Fproduct%252FMSP430F67751#:~:text=The%20design%20of%20delta%2Dsigma,from%20DC%20to%20several%20megahertz.21Integrating ADC- Добро шумопотискане и филтрация- Висока резолюция- Най-висока линейност- Ниско бързодействие- Ниска консумация на енергия- Ниска сложност- Използват се най-вече в измервателна апаратура (мултицети, LC измерватели)- Много са устойчиви на температурни промениMore info: Integrating ADC✭Думата "интегриране" означава сумиране на входния сигнал. Този тип АЦП добавя или комбинира входния сигнал за зададено време, за да направи стойност, която съответства на входа. При пълно съвпадение, тази добавена стойност се превръща в цифрова стойностhttps://www.monolithicpower.com/en/analog-to-digital-converters/detailed-analysis-of-adc-architectures/integrating-adcsЗадачи свързани с АЦП в Ардуино221. Изчислете LSB за АЦП на ATmega 328P, при следните параметриa. Разрядност 10 bitb. VREF = 5 V2. Изчислете динамичния диапазон в dB.3.⭐ Изчислете каква ще е цифровата стойност, преобразувана от АЦП за напрежение 3.3VDC. А за напрежение 6V ?